# node-astm

**node-astm** lets you read ASTM data from serial port. Supports Windows, Linux and OS X. Currently it can handle medical data generated by [HORIBA Pentra 60](http://www.horiba.com/medical/products/hematology/abx-pentra-60/) and Gallery Indiko machines. However, it is very easy to customize the code for any machine outputting ASTM data.

It outputs easy to process string data. You don't need to deal with buffers at all.

If you are looking for adding support to other devices, create an issue. I will be more than happy to help.

Pull requests are always welcome.

# Installation

```bash
npm install node-astm --save
```

# API & Usage

## Requiring
```js
let { HoribaPentra60Reader, HoribaPentra60Parser, GalleryIndikoReader, GalleryIndikoParser } = require('node-astm');
```

## HoribaPentra60Reader Class

### HoribaPentra60Reader#initiate(portString)
Initiates a connection. `portString` can be `COM1`, `COM4` etc on windows and `/dev/...` on other platforms.

### HoribaPentra60Reader#summarizeTransmission(transmission)
Compacts a raw transmission log into a string. Fit for simple string parsing.

### Event: `error`
The error event is emitted when there is a major (non-recoverable) error. Such as the port gets closed.

### Event: `log`
If you want verbosity, just listen to the log events. It outputs everything from errors to raw output.

### Event: `open`
Fired when the port is opened.

### Event: `data`
Fired when there is a complete transmission (`EOT` is received). You receive the full transmitted data in an array. You should use the `summarizeTransmission` method to convert the data into string.

## HoribaPentra60Parser Class

### HoribaPentra60Parser#parse(transmissionString)
Parses the transmissionString to extract *measurements/test results* and *suspected pathologies*. Other information is ignored as of now.

# Example

```js

let { HoribaPentra60Reader, HoribaPentra60Parser } = require('node-astm');

let machine = new HoribaPentra60Reader();

machine.on('log', (...args) => {
  console.log(...args);
});

machine.on('error', (error) => {
  console.log(error);
});

machine.on('parse-error', (error) => {
  console.log(error);
});

machine.on('data', (transmission) => {
  let string = machine.summarizeTransmission(transmission);
  let parser = new HoribaPentra60Parser();
  let results = parser.parse(string);
  console.log(results); // outputs { testResultList, suspectedPathologyList }
})

machine.initiate('COM4');
```

# LICENCE

[MIT](LICENSE)